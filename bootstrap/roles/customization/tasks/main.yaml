- block:
  - name: Ensure custom user exists with sudo group
    ansible.builtin.user:
      name: "{{ admin_user }}"
      create_home: true
      shell: /bin/bash
      groups: "{{ superuser_group }}"
      append: true
    tags:
      - customization
      - user

  - name: SSH key for custom user
    ansible.posix.authorized_key:
      user: "{{ admin_user }}"
      state: present
      key: "{{ admin_ssh_pub_key }}"
    tags:
      - customization
      - user
    when:
      - admin_ssh_pub_key is defined
      - admin_ssh_pub_key is not none

  - name: Bashrc and vimrc files (User)
    ansible.builtin.copy:
      dest: "/home/{{ admin_user }}/.{{ item }}"
      src: "{{ item }}"
      owner: "{{ admin_user }}"
      group: "{{ admin_user }}"
      mode: "0640"
    loop:
      - bashrc
      - vimrc
    tags:
      - customization

  - name: Bashrc and vimrc files (Root)
    ansible.builtin.copy:
      dest: "/root/.{{ item }}"
      src: "{{ item }}"
      owner: root
      group: root
      mode: "0640"
    loop:
      - bashrc
      - vimrc
    tags:
      - customization
  when:
    - admin_user is defined
    - admin_user is not none
